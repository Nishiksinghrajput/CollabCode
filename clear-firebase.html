<!DOCTYPE html>
<html>
<head>
    <title>Clear Firebase Sessions</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #0f0;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #005a9e;
        }
        #output {
            margin-top: 20px;
            padding: 20px;
            background: #000;
            border: 1px solid #333;
            min-height: 200px;
            white-space: pre-wrap;
        }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #ff0; }
    </style>
</head>
<body>
    <h1>Firebase Session Management</h1>
    
    <button onclick="clearAllSessions()">Clear All Sessions</button>
    <button onclick="listSessions()">List Active Sessions</button>
    <button onclick="testConnection()">Test Connection</button>
    <button onclick="debugRealtime()">Debug Realtime Sync</button>
    
    <div id="output"></div>

    <script src="https://www.gstatic.com/firebasejs/3.5.2/firebase.js"></script>
    <script>
        // Initialize Firebase
        const config = {
            apiKey: "AIzaSyDaTXD54QykZ7IIT8Ji9mZBqxhijRKLd3U",
            authDomain: "sneakers-688b6.firebaseapp.com",
            databaseURL: "https://sneakers-688b6.firebaseio.com",
            storageBucket: "sneakers-688b6.appspot.com",
            messagingSenderId: "553327129273"
        };
        
        firebase.initializeApp(config);
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const line = `[${timestamp}] ${message}\n`;
            const span = document.createElement('span');
            span.className = type;
            span.textContent = line;
            output.appendChild(span);
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        function clearAllSessions() {
            log('Clearing all sessions...', 'info');
            
            firebase.database().ref('sessions').remove()
                .then(() => {
                    log('‚úÖ All sessions cleared successfully!', 'success');
                    log('You can now create fresh sessions', 'info');
                })
                .catch(error => {
                    log('‚ùå Error clearing sessions: ' + error.message, 'error');
                });
        }
        
        function listSessions() {
            log('Fetching active sessions...', 'info');
            
            firebase.database().ref('sessions').once('value')
                .then(snapshot => {
                    const sessions = snapshot.val();
                    if (sessions) {
                        const sessionCount = Object.keys(sessions).length;
                        log(`Found ${sessionCount} active sessions:`, 'success');
                        Object.keys(sessions).forEach(sessionId => {
                            const session = sessions[sessionId];
                            const users = session.users ? Object.keys(session.users).length : 0;
                            log(`  - Session ${sessionId}: ${users} users`, 'info');
                        });
                    } else {
                        log('No active sessions found', 'info');
                    }
                })
                .catch(error => {
                    log('‚ùå Error fetching sessions: ' + error.message, 'error');
                });
        }
        
        function testConnection() {
            log('Testing Firebase connection...', 'info');
            
            const testRef = firebase.database().ref('connection-test');
            const testData = {
                message: 'Hello from clear-firebase',
                timestamp: Date.now()
            };
            
            // Test write
            testRef.set(testData)
                .then(() => {
                    log('‚úÖ Write successful', 'success');
                    // Test read
                    return testRef.once('value');
                })
                .then(snapshot => {
                    const data = snapshot.val();
                    log('‚úÖ Read successful: ' + JSON.stringify(data), 'success');
                    // Clean up
                    return testRef.remove();
                })
                .then(() => {
                    log('‚úÖ Cleanup successful', 'success');
                    log('Firebase connection is working properly!', 'success');
                })
                .catch(error => {
                    log('‚ùå Connection test failed: ' + error.message, 'error');
                });
        }
        
        function debugRealtime() {
            log('Starting real-time sync debug...', 'info');
            
            // Create a test session
            const testSessionRef = firebase.database().ref('sessions/debug-' + Date.now());
            
            log('Creating test session...', 'info');
            
            // Set initial data
            testSessionRef.set({
                created: Date.now(),
                test: 'initial'
            }).then(() => {
                log('‚úÖ Test session created', 'success');
                
                // Listen for changes
                testSessionRef.on('value', function(snapshot) {
                    const data = snapshot.val();
                    log('üì° Received update: ' + JSON.stringify(data), 'info');
                });
                
                // Make changes
                setTimeout(() => {
                    log('Updating test data...', 'info');
                    testSessionRef.update({ test: 'updated', timestamp: Date.now() });
                }, 1000);
                
                setTimeout(() => {
                    log('Adding child data...', 'info');
                    testSessionRef.child('users').push({ name: 'Test User' });
                }, 2000);
                
                setTimeout(() => {
                    log('Cleaning up test session...', 'info');
                    testSessionRef.remove();
                    log('‚úÖ Debug complete', 'success');
                }, 5000);
            }).catch(error => {
                log('‚ùå Debug failed: ' + error.message, 'error');
            });
        }
        
        // Test connection on load
        window.onload = function() {
            firebase.database().ref('.info/connected').on('value', function(snapshot) {
                if (snapshot.val() === true) {
                    log('‚úÖ Firebase connected', 'success');
                } else {
                    log('‚ö†Ô∏è Firebase disconnected', 'error');
                }
            });
        };
    </script>
</body>
</html>