<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Bernie Perez">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Code Editor</title>
    <link rel="apple-touch-icon" sizes="57x57" href="/images/favicon/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-touch-icon-152x152.png">
    <link rel="icon" type="image/png" sizes="196x196" href="/images/favicon/favicon-196x196.png">
    <link rel="icon" type="image/png" sizes="128x128" href="/images/favicon/favicon-128x128.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">

    <!-- styling -->
    <!-- Custom style -->
    <link rel="stylesheet" href="/styles/main.css">
    <!-- Firepad -->
    <link rel="stylesheet" href="https://cdn.firebase.com/libs/firepad/1.4.0/firepad.css" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- scripts -->
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/3.5.2/firebase.js"></script>
    <script src="/lib/firebase-sdk.js"></script>
    <!-- ACE and its JavaScript mode and theme files - Updated to latest -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.33.2/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.33.2/ext-language_tools.js"></script>
    <!-- Firepad -->
    <script src="https://cdn.firebase.com/libs/firepad/1.4.0/firepad.min.js"></script>
    <!-- Code Executor -->
    <script src="/scripts/code-executor.js"></script>
    <!-- Authentication -->
    <script src="/scripts/auth-api.js"></script>
  </head>
  <body>
    <!-- Landing Modal -->
    <div id="landingModal" class="modal atom-landing">
      <div class="atom-background">
        <div class="atom-gradient"></div>
        <div class="floating-shapes">
          <div class="shape shape-1"></div>
          <div class="shape shape-2"></div>
          <div class="shape shape-3"></div>
          <div class="shape shape-4"></div>
        </div>
      </div>
      
      <div class="modal-content landing-content atom-card">
        <div class="atom-logo-section">
          <div class="atom-logo">
            <svg width="50" height="50" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="8" fill="#018ef5"/>
              <ellipse cx="50" cy="50" rx="40" ry="15" fill="none" stroke="#018ef5" stroke-width="2" transform="rotate(45 50 50)"/>
              <ellipse cx="50" cy="50" rx="40" ry="15" fill="none" stroke="#018ef5" stroke-width="2" transform="rotate(-45 50 50)"/>
              <ellipse cx="50" cy="50" rx="40" ry="15" fill="none" stroke="#018ef5" stroke-width="2" transform="rotate(0 50 50)"/>
            </svg>
          </div>
          <h1 class="atom-title">Code Interview Platform</h1>
          <p class="atom-subtitle">Powered by Atom Tickets Engineering</p>
        </div>
        
        <div class="role-selection atom-roles">
          <div class="role-card atom-role-card" id="candidateCard">
            <div class="role-icon atom-icon">
              <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="#018ef5"/>
                <path d="M8.5 12.5L7 14l3 3 5-5-1.5-1.5L10.5 13.5z" fill="#4CAF50"/>
              </svg>
            </div>
            <h3>Join as Candidate</h3>
            <p>Enter your interview session</p>
            <button class="role-btn atom-btn atom-btn-secondary" onclick="document.getElementById('landingModal').style.display='none'; document.getElementById('candidateModal').style.display='flex'; return false;">
              <span>I'm a Candidate</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" fill="currentColor"/>
              </svg>
            </button>
          </div>
          
          <div class="role-divider atom-divider">
            <span>OR</span>
          </div>
          
          <div class="role-card atom-role-card" id="adminCard">
            <div class="role-icon atom-icon">
              <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#018ef5"/>
              </svg>
            </div>
            <h3>Login as Interviewer</h3>
            <p>Create & manage sessions</p>
            <button class="role-btn atom-btn atom-btn-primary" onclick="document.getElementById('landingModal').style.display='none'; document.getElementById('adminLoginModal').style.display='flex'; return false;">
              <span>I'm an Interviewer</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" fill="currentColor"/>
              </svg>
            </button>
          </div>
        </div>
        
        <div class="atom-features">
          <div class="feature-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#018ef5">
              <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
            </svg>
            <span>Real-time Collaboration</span>
          </div>
          <div class="feature-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#018ef5">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <span>16+ Languages</span>
          </div>
          <div class="feature-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#018ef5">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
            </svg>
            <span>Live Code Execution</span>
          </div>
        </div>
      </div>
      
      <footer class="atom-footer">
        <div class="footer-content">
          <p>Made with ❤️ at <a href="https://www.atomtickets.com" target="_blank" class="atom-link">Atom Tickets</a></p>
          <div class="footer-links">
            <a href="https://www.atomtickets.com" target="_blank">Home</a>
            <span class="footer-separator">•</span>
            <a href="https://www.atomtickets.com/movies" target="_blank">Browse Movies</a>
            <span class="footer-separator">•</span>
            <a href="https://www.atomtickets.com/theaters" target="_blank">Find Theaters</a>
          </div>
        </div>
      </footer>
    </div>
    
    <!-- Candidate Join Modal -->
    <div id="candidateModal" class="modal" style="display: none;">
      <div class="modal-content">
        <button class="back-btn" id="candidateBack">← Back</button>
        <h2>Join Interview Session</h2>
        <p class="modal-subtitle">Enter your details to join the session</p>
        
        <div class="form-group">
          <label>Your Name</label>
          <input type="text" id="candidateName" placeholder="Enter your full name" maxlength="50">
        </div>
        
        <div class="form-group">
          <label>Session Code</label>
          <input type="text" id="candidateSessionCode" placeholder="6-digit code (e.g., 123456)" maxlength="6">
          <small>Your interviewer will provide this code</small>
        </div>
        
        <button id="candidateJoinBtn" class="primary-btn" disabled>Join Session</button>
      </div>
    </div>
    
    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal" style="display: none;">
      <div class="modal-content">
        <button class="back-btn" id="adminLoginBack">← Back</button>
        <h2>Interviewer Login</h2>
        <p class="modal-subtitle">Login to create and manage sessions</p>
        
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="adminEmail" placeholder="Enter your email">
        </div>
        
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="adminPassword" placeholder="Enter your password">
        </div>
        
        <button id="adminLoginBtn" class="primary-btn">Login</button>
        <div id="loginError" class="error-message" style="display: none;"></div>
      </div>
    </div>
    
    <!-- Admin Dashboard Modal -->
    <div id="adminDashboardModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="dashboard-header">
          <h2>Interviewer Dashboard</h2>
          <button id="adminLogoutBtn" class="logout-btn">Logout</button>
        </div>
        
        <div class="session-management">
          <h3>Session Management</h3>
          
          <div class="action-buttons">
            <button id="createSessionBtn" class="primary-btn">
              <span>+ Create New Session</span>
            </button>
            
            <div class="divider">
              <span>OR</span>
            </div>
            
            <div class="join-existing">
              <input type="text" id="adminSessionCode" placeholder="Enter session code" maxlength="6">
              <button id="adminJoinBtn" class="secondary-btn">Join Existing</button>
            </div>
          </div>
          
          <div id="activeSession" class="active-session" style="display: none;">
            <h4>Current Session</h4>
            <div class="session-info">
              <p>Session Code: <strong id="activeSessionCode"></strong></p>
              <button id="copyCodeBtn" class="copy-btn">Copy Code</button>
            </div>
          </div>
          
          <div class="admin-tools">
            <button id="viewAllSessionsBtn" class="secondary-btn" style="margin-top: 20px;">
              📊 View All Active Sessions
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Sessions Management Modal -->
    <div id="sessionsModal" class="modal" style="display: none;">
      <div class="modal-content sessions-modal-content">
        <div class="modal-header">
          <h2>Sessions Management</h2>
          <button id="closeSessionsModalBtn" class="close-modal-btn">×</button>
        </div>
        
        <div class="sessions-stats">
          <div class="stat-item">
            <span class="stat-label">Active Sessions:</span>
            <span id="activeSessionsCount" class="stat-value">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total Users:</span>
            <span id="totalUsersCount" class="stat-value">0</span>
          </div>
        </div>
        
        <div class="session-tabs">
          <button id="activeTabBtn" class="tab-btn active">Active Sessions</button>
          <button id="archivedTabBtn" class="tab-btn">Archived (History)</button>
        </div>
        
        <div class="bulk-actions" id="bulkActionsBar">
          <button id="selectAllBtn" class="select-all-btn">Select All</button>
          <button id="endSelectedBtn" class="end-selected-btn" disabled>End Selected</button>
          <button id="endAllSessionsBtn" class="end-all-btn">End All Sessions</button>
        </div>
        
        <div id="sessionsTableContainer">
          <table id="sessionsTable" class="sessions-table">
            <thead>
              <tr>
                <th style="width: 40px;">
                  <input type="checkbox" id="selectAllCheckbox" title="Select All">
                </th>
                <th>Session Code</th>
                <th>Status</th>
                <th>Candidate</th>
                <th>All Participants</th>
                <th>Created</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="sessionsTableBody">
              <!-- Sessions will be populated here -->
            </tbody>
          </table>
          <div id="noSessionsMessage" class="no-sessions-message" style="display: none;">
            <p>No active sessions at the moment</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main Editor Interface -->
    <div id="main-container" style="display: none;">
      <!-- Top Bar -->
      <div id="top-bar">
        <div class="left-controls">
          <select id="language-selector" title="Select Language">
            <optgroup label="Popular">
              <option value="javascript">🟨 JavaScript</option>
              <option value="python">🐍 Python</option>
              <option value="java">☕ Java</option>
              <option value="typescript">🔵 TypeScript</option>
              <option value="c_cpp">🔷 C/C++</option>
            </optgroup>
            <optgroup label="Systems">
              <option value="go">🐹 Go</option>
              <option value="rust">🦀 Rust</option>
              <option value="csharp">🟦 C#</option>
              <option value="swift">🍎 Swift</option>
              <option value="kotlin">🟪 Kotlin</option>
            </optgroup>
            <optgroup label="Scripting">
              <option value="ruby">💎 Ruby</option>
              <option value="php">🐘 PHP</option>
              <option value="perl">🐪 Perl</option>
              <option value="lua">🌙 Lua</option>
            </optgroup>
            <optgroup label="Functional">
              <option value="scala">🔴 Scala</option>
              <option value="haskell">🎓 Haskell</option>
              <option value="elixir">💧 Elixir</option>
            </optgroup>
            <optgroup label="Data & Stats">
              <option value="r">📊 R</option>
              <option value="sql">🗄️ SQL</option>
            </optgroup>
            <optgroup label="Mobile">
              <option value="dart">🎯 Dart</option>
              <option value="swift">🍎 Swift</option>
              <option value="kotlin">🟪 Kotlin</option>
            </optgroup>
            <optgroup label="Web">
              <option value="html">🌐 HTML</option>
              <option value="css">🎨 CSS</option>
              <option value="javascript">🟨 JavaScript</option>
              <option value="typescript">🔵 TypeScript</option>
            </optgroup>
            <optgroup label="Config">
              <option value="json">📋 JSON</option>
              <option value="yaml">📄 YAML</option>
              <option value="xml">📰 XML</option>
              <option value="markdown">📝 Markdown</option>
            </optgroup>
          </select>
          
          <select id="theme-selector">
            <option value="monokai">Monokai</option>
            <option value="github">GitHub</option>
            <option value="tomorrow">Tomorrow</option>
            <option value="twilight">Twilight</option>
            <option value="solarized_dark">Solarized Dark</option>
            <option value="solarized_light">Solarized Light</option>
            <option value="textmate">TextMate</option>
            <option value="terminal">Terminal</option>
          </select>

          <select id="fontSize-selector">
            <option value="12">12px</option>
            <option value="14" selected>14px</option>
            <option value="16">16px</option>
            <option value="18">18px</option>
            <option value="20">20px</option>
          </select>
        </div>

        <div class="center-info">
          <span id="session-info"></span>
          <button id="end-session-btn" class="end-session-button" style="margin-left: 15px;">End Interview</button>
          <span id="user-count" class="user-count"></span>
        </div>

        <div class="right-controls">
          <div id="users-list"></div>
          <button id="run-btn" class="run-button">▶ Run</button>
          <button id="share-btn">Share</button>
        </div>
      </div>

      <!-- Editor Container with Split View -->
      <div id="editor-wrapper">
        <div id="split-container">
          <div id="firepad-container"></div>
          <div id="output-panel" style="display: none;">
            <div id="output-header">
              <span>Output</span>
              <button id="clear-output">Clear</button>
              <button id="close-output">×</button>
            </div>
            <div id="output-content">
              <pre id="output-text"></pre>
            </div>
            <div id="input-section" style="display: none;">
              <label>Input (stdin):</label>
              <textarea id="stdin-input" placeholder="Enter input for your program..."></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Status Bar -->
      <div id="status-bar">
        <span id="cursor-position">Line 1, Column 1</span>
        <span id="connection-status" class="connected">Connected</span>
      </div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="customAlertModal" class="custom-modal" style="display: none;">
      <div class="custom-modal-content">
        <div class="custom-modal-icon"></div>
        <h3 class="custom-modal-title"></h3>
        <p class="custom-modal-message"></p>
        <div class="custom-modal-buttons">
          <button class="custom-modal-btn primary" onclick="closeCustomAlert()">OK</button>
        </div>
      </div>
    </div>
    
    <!-- Custom Confirm Modal -->
    <div id="customConfirmModal" class="custom-modal" style="display: none;">
      <div class="custom-modal-content">
        <div class="custom-modal-icon"></div>
        <h3 class="custom-modal-title"></h3>
        <p class="custom-modal-message"></p>
        <div class="custom-modal-buttons">
          <button class="custom-modal-btn cancel" onclick="handleConfirmResponse(false)">Cancel</button>
          <button class="custom-modal-btn confirm" onclick="handleConfirmResponse(true)">Confirm</button>
        </div>
      </div>
    </div>

    <!-- Simple Templates (must load before firepad.js) -->
    <script src="/scripts/simple-templates.js"></script>
    <script src="/scripts/custom-dialogs.js"></script>
    <script src="/scripts/firepad.js"></script>
    <script src="/scripts/app.js"></script>
  </body>
</html>
